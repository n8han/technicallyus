<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.1//EN"  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>NSString+CarbonFSSpecCreation.m</title>
	<link rel="stylesheet" type="text/css" href="highlight.css"/>
</head>
<body>
<pre><span class="dir">#import </span><span class="dstr">&quot;NSString+CarbonFSSpecCreation.h&quot;</span><span class="dir">
</span>
&#64;implementation NSString (CarbonFSSpecCreation)

- (BOOL) getFSRef:(FSRef*)fsRef createFileIfNecessary:(BOOL)createFile
{
    NSFileManager* fileManager = [NSFileManager defaultManager];
    CFURLRef urlRef;
    Boolean gotFSRef;

    </pre><div class="com">// Check whether the file exists already.  If not, create an empty file if requested.
</div><pre>    <span class="key">if </span>(![fileManager fileExistsAtPath:self]) {
        <span class="key">if </span>(createFile) {
            <span class="key">if </span>(![&#64;<span class="str">&quot;&quot;</span> writeToFile:self atomically:YES]) {
                <span class="key">return </span>NO;
            }
        } <span class="key">else </span>{
            <span class="key">return </span>NO;
        }
    }

    </pre><div class="com">// Create a CFURL with the specified POSIX path.
</div><pre>    urlRef = CFURLCreateWithFileSystemPath( kCFAllocatorDefault,
                                            (CFStringRef) self,
                                            kCFURLPOSIXPathStyle,
                                            FALSE </pre><div class="com">/* isDirectory */</div><pre> );
    <span class="key">if </span>(urlRef == NULL) {
</pre><div class="com">//        printf( &quot;** Couldn't make a CFURLRef for the file.\n&quot; );
</div><pre>        <span class="key">return </span>NO;
    }

    </pre><div class="com">// Try to create an FSRef from the URL.  (If the specified file doesn't exist, this
</div><pre>    </pre><div class="com">// function will return false, but if we've reached this code we've already insured
</div><pre>    </pre><div class="com">// that the file exists.)
</div><pre>    gotFSRef = CFURLGetFSRef( urlRef, fsRef );
    CFRelease( urlRef );

    <span class="key">if </span>(!gotFSRef) {
</pre><div class="com">//        printf( &quot;** Couldn't get an FSRef for the file.\n&quot; );
</div><pre>        <span class="key">return </span>NO;
    }

    <span class="key">return </span>YES;
}

- (BOOL) getFSSpec:(FSSpec*)fsSpec createFileIfNecessary:(BOOL)createFile
{
    FSRef fsRef;

    <span class="key">if </span>(![self getFSRef:&amp;fsRef createFileIfNecessary:createFile])
        <span class="key">return </span>NO;

    <span class="key">if </span>(FSGetCatalogInfo( &amp;fsRef,
                          kFSCatInfoNone,
                          NULL,
                          NULL,
                          fsSpec,
                          NULL ) != noErr) {
        </pre><div class="com">//        printf( &quot;** Couldn't get an FSSpec for the file.\n&quot; );
</div><pre>        <span class="key">return </span>NO;
    }

    <span class="key">return </span>YES;
}

&#64;end
</pre>
</body>
</html>
<!--XHTML generated by highlight 2.0-19, http://www.andre-simon.de/-->
